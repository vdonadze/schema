apiVersion: th2.exactpro.com/v2
kind: Th2Box
metadata:
  name: read-log
spec:
  imageName: ghcr.io/th2-net/th2-read-log
  imageVersion: 4.0.0-th2-2150-books-pages-2165830041
  type: th2-read
  # bookName: testscript
  customConfig:
    logDirectory: /logsToRead/
    aliases:
      csvtest7:
        regexp: "(([A-Za-z]+(?<!persist))=[\\{].*[\\}])"
        pathFilter: "csv5.txt"
        joinGroups: true
        headersFormat:
          MsgType: "${2}"
          MsgBody: "${1}"
        timestampRegexp: "^202.*?(?= Test)"
        timestampFormat: "yyyy-MM-dd HH:mm:ss.SSSSSS"
      # csvtest3:
      #   regexp: "(([A-Za-z]+(?<!persist))=[\\{].*[\\}])"
      #   pathFilter: "csv3.txt"
      #   joinGroups: true
      #   headersFormat:
      #     MsgType: "${2}"
      #     MsgBody: "${1}"
      #   timestampRegexp: "^202.*?(?= Test)"
      #   timestampFormat: "yyyy-MM-dd HH:mm:ss.SSSSSS" 

      # fixalias11:
      #   regexp: "8=FIX.+10=.+[|]"
      #   pathFilter: "alias1.txt"
      #   groups: [ 0 ]
      #   timestampRegexp: "^202.*?(?= 8=FIXT)"
      #   timestampFormat: "yyyy-MM-dd HH:mm:ss.SSSSSS"
    common:
      staleTimeout: PT1S
      maxBatchSize: 100
      maxPublicationDelay: PT1S
      leaveLastFileOpen: true
      fixTimestamp: false
      maxBatchesPerSecond: 100
    pullingInterval: PT1S
  extendedSettings:
    envVariables:
      JAVA_TOOL_OPTIONS: -XX:+ExitOnOutOfMemoryError
    mounting:
      - path: "/logsToRead/"
        pvcName: components
    resources:
      limits:
        cpu: 500m
        memory: 300Mi
      requests:
        cpu: 20m
        memory: 100Mi
  pins:
    mq:
      subscribers:
      publishers:
      - name: read_log_out
        attributes:
        - raw
        - publish
        - store
  loggingConfig: |
    log4j.rootLogger=TRACE, CON
    log4j.appender.CON=org.apache.log4j.ConsoleAppender
    log4j.appender.CON.layout=org.apache.log4j.PatternLayout
    log4j.appender.CON.layout.ConversionPattern=%d{dd MMM yyyy HH:mm:ss,SSS} %-6p [%-15t] %c - %m%n
    log4j.logger.com.exactpro.th2.readlog.impl.RegexpContentParser=TRACE
    log4j.logger.com.exactpro.th2=TRACE

